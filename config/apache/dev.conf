<VirtualHost *:80>
    ServerName dev.___APP_NAME___.fr

    # Simulate internet connection not over VPN for debug only
    #RequestHeader set X-Forwarded-For "193.123.25.65"

    # Allow VPN clients passing through reverse proxy
    SetEnvIf X-Forwarded-For ^172\. VPN=1
    # Allow Locals servers
    SetEnvIf REMOTE_ADDR ^172\. VPN=1
    # Pass Authorization header
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

    # Setting the HOME variable used by blackfire to load his .ini
    SetEnv HOME /home/sitm

    DocumentRoot /var/www/___APP_NAME___/___WEB_PATH___
    <Directory /var/www/___APP_NAME___/___WEB_PATH___>
        Options -Indexes
        AllowOverride None
        Order Allow,Deny
        Allow from All

        <IfModule mod_rewrite.c>
            Options -MultiViews
            RewriteEngine On
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_URI} !^/server-status$
            RewriteRule ^(.*)$ index.php [QSA,L]
        </IfModule>
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/___APP_NAME___-dev.error.log

    LogLevel debug
    #LogLevel alert rewrite:trace6
    # tail -f /var/log/apache2/sitm-dev.error.log | fgrep '[rewrite:'

    LogFormat "[pid %P] %h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "[pid %P] %{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" proxy
    SetEnvIf X-Forwarded-For "^.*\..*\..*\..*" forwarded
    CustomLog ${APACHE_LOG_DIR}/___APP_NAME___-dev.access.log combined env=!forwarded
</VirtualHost>
